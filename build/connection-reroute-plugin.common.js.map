{"version":3,"file":"connection-reroute-plugin.common.js","sources":["../src/Pin.vue","../src/Pins.vue","../src/index.js"],"sourcesContent":["<template lang=\"pug\">\r\n.pin(\r\n  :style=\"{left: pin.x+'px', top: pin.y+'px'}\"\r\n  @pointerdown=\"down\"\r\n  @pointerup=\"pinup\"\r\n)\r\n</template>\r\n\r\n\r\n<script>\r\nconst State = { PICKED: 0, MOVED: 1, DROPED: 2}\r\n\r\nexport default {\r\n  props: ['pin', 'change', 'remove'],\r\n  inject: ['editor', 'connection'],\r\n  data() {\r\n    return {\r\n      state: State.DROPED\r\n    }\r\n  },\r\n  mounted() {\r\n    window.addEventListener('pointermove', this.move);\r\n    window.addEventListener('pointerup', this.up);\r\n  },\r\n  destroyed() {\r\n    window.removeEventListener('pointermove', this.move);\r\n    window.removeEventListener('pointerup', this.up);\r\n  },\r\n  methods: {\r\n    setPosition(x, y) {\r\n      this.$emit('change', {x, y});\r\n      this.$forceUpdate();\r\n    },\r\n    down(e){\r\n      e.stopPropagation();\r\n      this.state = State.PICKED;\r\n    },\r\n    move(e){\r\n      if(this.state === State.DROPED) return;\r\n\r\n      this.state = State.MOVED;\r\n      e.preventDefault();\r\n\r\n      const { mouse } = this.editor.view.area;\r\n\r\n      this.setPosition(mouse.x, mouse.y);\r\n    },\r\n    up(e) {\r\n      this.state = State.DROPED;\r\n    },\r\n    pinup() {\r\n      if(this.state === State.MOVED) return;\r\n\r\n      this.$emit('remove', this.pin);\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style lang=\"sass\" scoped>\r\n$size: 20px\r\n\r\n.pin\r\n  position: absolute\r\n  display: inline\r\n  width: $size\r\n  height: $size\r\n  background: lighten(steelblue, 20%)\r\n  border-radius: 50%\r\n  transform: translate(-50%, -50%)\r\n</style>\r\n","<template lang=\"pug\">\r\ndiv\r\n  Pin(v-for=\"pin in pins\" :pin=\"pin\"\r\n    @change=\"change(pin, $event)\"\r\n    @remove=\"remove(pin)\"\r\n    :key=\"pin.x + ' ' + pin.y\"\r\n  )\r\n</template>\r\n\r\n\r\n<script>\r\nimport Pin from './Pin.vue';\r\n\r\nexport default {\r\n  props: ['pins'],\r\n  inject: ['editor', 'connection'],\r\n  methods: {\r\n    change(pin, {x, y}) {\r\n      pin.x = x;\r\n      pin.y = y;\r\n      this.editor.view.connections.get(this.connection).update();\r\n    },\r\n    remove(pin) {\r\n      this.pins.splice(this.pins.indexOf(pin), 1);\r\n      this.editor.view.connections.get(this.connection).update();\r\n      this.$forceUpdate();\r\n    }\r\n  },\r\n  components: {\r\n    Pin\r\n  }\r\n}\r\n</script>","import Vue from 'vue';\r\nimport * as ConnectionPlugin from 'rete-connection-plugin';\r\nimport Pins from './Pins.vue';\r\n\r\nfunction install(editor, params) {\r\n\r\n    editor.on('connectionpath', data => {\r\n        const { connection } = data;\r\n        const [x1, y1, x2, y2] = data.points;\r\n        const pins = connection && connection.data.pins ? connection.data.pins : [];\r\n        const p = [[x1, y1], ...pins.map(p => [p.x, p.y]), [x2, y2]];\r\n\r\n        let d = '';\r\n\r\n        for (var i = 1; i < p.length; i++)\r\n            d += ' '+ConnectionPlugin.defaultPath([...p[i - 1], ...p[i]], 0.4)\r\n\r\n        data.d = d;\r\n    });\r\n\r\n    editor.on('renderconnection', ({ el, connection }) => {\r\n        const path = el.querySelector('.connection path');\r\n        const pins = connection.data.pins || (connection.data.pins = []);\r\n\r\n        if (!path) throw new Error('<path> not found');\r\n\r\n        path.addEventListener('click', () => {\r\n            const { mouse } = editor.view.area;\r\n            const pin = { ...mouse };\r\n\r\n            pins.push(pin);\r\n            \r\n            app.$children[0].$forceUpdate();\r\n        });\r\n\r\n        const vueContainer = document.createElement('div');\r\n\r\n        el.appendChild(vueContainer);\r\n   \r\n        const app = new Vue({\r\n            provide: {\r\n                editor,\r\n                connection\r\n            },\r\n            render: h => h(Pins, { props: { pins } })\r\n        }).$mount(vueContainer)\r\n    })\r\n}\r\n\r\nexport default {\r\n    install\r\n}"],"names":["install","editor","params","on","data","connection","points","x1","y1","x2","y2","pins","p","map","x","y","d","i","length","ConnectionPlugin","el","path","querySelector","Error","addEventListener","mouse","view","area","pin","push","app","$children","$forceUpdate","vueContainer","document","createElement","appendChild","Vue","provide","render","h","Pins","props","$mount"],"mappings":"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"}