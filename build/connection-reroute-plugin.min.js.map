{"version":3,"file":"connection-reroute-plugin.min.js","sources":["../src/Pin.vue","../src/index.js"],"sourcesContent":["<template lang=\"pug\">\r\n.pin(\r\n  :style=\"{left: pin.x+'px', top: pin.y+'px'}\"\r\n  @pointerdown=\"down\"\r\n  @pointerup=\"pinup\"\r\n)\r\n</template>\r\n\r\n\r\n<script>\r\nconst State = { PICKED: 0, MOVED: 1, DROPED: 2}\r\n\r\nexport default {\r\n  props: ['pin', 'change', 'remove'],\r\n  inject: ['editor', 'connection'],\r\n  data() {\r\n    return {\r\n      state: State.DROPED\r\n    }\r\n  },\r\n  mounted() {\r\n    window.addEventListener('pointermove', this.move);\r\n    window.addEventListener('pointerup', this.up);\r\n  },\r\n  destroyed() {\r\n    window.removeEventListener('pointermove', this.move);\r\n    window.removeEventListener('pointerup', this.up);\r\n  },\r\n  methods: {\r\n    setPosition(x, y) {\r\n      this.$emit('change', {x, y});\r\n      this.$forceUpdate();\r\n    },\r\n    down(e){\r\n      e.stopPropagation();\r\n      this.state = State.PICKED;\r\n    },\r\n    move(e){\r\n      if(this.state === State.DROPED) return;\r\n\r\n      this.state = State.MOVED;\r\n      e.preventDefault();\r\n\r\n      const { mouse } = this.editor.view.area;\r\n\r\n      this.setPosition(mouse.x, mouse.y);\r\n    },\r\n    up(e) {\r\n      this.state = State.DROPED;\r\n    },\r\n    pinup() {\r\n      if(this.state === State.MOVED) return;\r\n\r\n      this.$emit('remove', this.pin);\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style lang=\"sass\" scoped>\r\n$size: 20px\r\n\r\n.pin\r\n  position: absolute\r\n  display: inline\r\n  width: $size\r\n  height: $size\r\n  background: lighten(steelblue, 20%)\r\n  border-radius: 50%\r\n  transform: translate(-50%, -50%)\r\n</style>\r\n","import Vue from 'vue';\r\nimport * as ConnectionPlugin from 'rete-connection-plugin';\r\nimport Pins from './Pins.vue';\r\n\r\nfunction install(editor, params) {\r\n\r\n    editor.on('connectionpath', data => {\r\n        const { connection } = data;\r\n        const [x1, y1, x2, y2] = data.points;\r\n        const pins = connection && connection.data.pins ? connection.data.pins : [];\r\n        const p = [[x1, y1], ...pins.map(p => [p.x, p.y]), [x2, y2]];\r\n\r\n        let d = '';\r\n\r\n        for (var i = 1; i < p.length; i++)\r\n            d += ' '+ConnectionPlugin.defaultPath([...p[i - 1], ...p[i]], 0.4)\r\n\r\n        data.d = d;\r\n    });\r\n\r\n    editor.on('renderconnection', ({ el, connection }) => {\r\n        const path = el.querySelector('.connection path');\r\n        const pins = connection.data.pins || (connection.data.pins = []);\r\n\r\n        if (!path) throw new Error('<path> not found');\r\n\r\n        path.addEventListener('click', () => {\r\n            const { mouse } = editor.view.area;\r\n            const pin = { ...mouse };\r\n\r\n            pins.push(pin);\r\n            \r\n            app.$children[0].$forceUpdate();\r\n        });\r\n\r\n        const vueContainer = document.createElement('div');\r\n\r\n        el.appendChild(vueContainer);\r\n   \r\n        const app = new Vue({\r\n            provide: {\r\n                editor,\r\n                connection\r\n            },\r\n            render: h => h(Pins, { props: { pins } })\r\n        }).$mount(vueContainer)\r\n    })\r\n}\r\n\r\nexport default {\r\n    install\r\n}"],"names":["install","editor","params","on","data","connection","points","x1","y1","x2","y2","pins","p","map","x","y","d","i","length","ConnectionPlugin","el","path","querySelector","Error","addEventListener","pin","view","area","mouse","push","app","$children","$forceUpdate","vueContainer","document","createElement","appendChild","Vue","provide","render","h","Pins","props","$mount"],"mappings":";;;;;uuOAUA,2nICuCe,CACXA,QA9CJ,SAAiBC,EAAQC,GAErBD,EAAOE,GAAG,iBAAkB,SAAAC,WAChBC,EAAeD,EAAfC,eACiBD,EAAKE,UAAvBC,OAAIC,OAAIC,OAAIC,OACbC,EAAON,GAAcA,EAAWD,KAAKO,KAAON,EAAWD,KAAKO,KAAO,GACnEC,GAAK,CAACL,EAAIC,aAAQG,EAAKE,IAAI,SAAAD,SAAK,CAACA,EAAEE,EAAGF,EAAEG,OAAK,CAACN,EAAIC,KAEpDM,EAAI,GAECC,EAAI,EAAGA,EAAIL,EAAEM,OAAQD,IAC1BD,GAAK,IAAIG,0BAAiCP,EAAEK,EAAI,MAAOL,EAAEK,KAAK,IAElEb,EAAKY,EAAIA,IAGbf,EAAOE,GAAG,mBAAoB,gBAAGiB,IAAAA,GAAIf,IAAAA,WAC3BgB,EAAOD,EAAGE,cAAc,oBACxBX,EAAON,EAAWD,KAAKO,OAASN,EAAWD,KAAKO,KAAO,QAExDU,EAAM,MAAM,IAAIE,MAAM,oBAE3BF,EAAKG,iBAAiB,QAAS,eAErBC,gbADYxB,EAAOyB,KAAKC,KAAtBC,OAGRjB,EAAKkB,KAAKJ,GAEVK,EAAIC,UAAU,GAAGC,qBAGfC,EAAeC,SAASC,cAAc,OAE5Cf,EAAGgB,YAAYH,OAETH,EAAM,IAAIO,EAAI,CAChBC,QAAS,CACLrC,OAAAA,EACAI,WAAAA,GAEJkC,OAAQ,SAAAC,UAAKA,EAAEC,EAAM,CAAEC,MAAO,CAAE/B,KAAAA,QACjCgC,OAAOV"}